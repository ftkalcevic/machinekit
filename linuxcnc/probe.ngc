; grid probe

#<BedDiameter> = 180.0
#<ProbeGrid> = 26.0
#<_ZHeight> = 15.0
#<_ProbeFeedRate> = 1500
#<_ProbeTipOffsetX> = 0
#<_ProbeTipOffsetY> = 15
#<_ProbeTipOffsetZ> = -7.2

o1000 sub 
    #<x> = [#1 - #<_ProbeTipOffsetX>]
    #<y> = [#2 - #<_ProbeTipOffsetY>]

    G0 Z[#<_ZHeight>]
    G0 X[#<x>] Y[#<y>]
    G38.2 Z0 F[#<_ProbeFeedRate>]
    G0 Z[#<_ZHeight>]

    o1010 if [ #5070 EQ 1 ]
        #<z> = [#5063 + #<_ProbeTipOffsetZ>]
        (print, probe #<x>,#<y>,  #5063, #<z>)
    o1010 endif
o1000 endsub


#<BedRadius> = [ #<BedDiameter> / 2 ]
#<count> = FIX[ #<BedDiameter> / 2 / #<ProbeGrid> ]

#<dir> = 1
#<yi> = [-1 * #<count>]
o10 while [#<yi> LE #<count>]

    #<xi> = [-1 * #<count>]
    o20 while [#<xi> LE #<count>]

        #<x> = [#<ProbeGrid> * #<dir> * #<xi>]
        #<y> = [#<ProbeGrid> * #<yi>]

        o30 if [ [ #<x> * #<x> + #<y> * #<y> ] LE [#<BedRadius> * #<BedRadius>] ]
            o1000 call [#<x>] [#<y>]

        o30 endif

        #<xi> = [#<xi> + 1]
    
    o20 endwhile

    #<dir> = [-1 * #<dir>]
    #<yi> = [#<yi> + 1]
    
o10 endwhile

M2

